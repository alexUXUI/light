<html>

  <head>
    <style>
      body{ margin: 0px; }
      html{ overflow: hidden }
    </style>
  </head>

  <body>

    <script src="lib/three.min.js">             </script>
    <script src="lib/jquery.min.js">            </script>
    <script src="lib/ShaderLoader.js">          </script>

    <script src="lib/ScrollControls.js">        </script>
    <script src="lib/ObjectControls.js">        </script>
    
    <script src="fonts/PTMono.js">              </script>
    <script src="TextParticles.js">             </script>

    <script src="text/passage.js">              </script>
    <script src="text/love.js">              </script>

    <script src="Light.js">              </script>
    <script src="js/CrystalGeo.js">              </script>
    <script src="js/RayGeo.js">              </script>
    <script src="js/Link.js">              </script>
   

    <script>

      var T = THREE;


      var camera, renderer, scene , controls , clock;
      
      var textParticles;


      var time = { type:"f" , value: 1 }
      var shaders = new ShaderLoader( 'examples/fade/shaders' );

      shaders.shaderSetLoaded = function(){
        init();
        animate();
      }

      shaders.load( 'vs-text' , 'text' , 'vertex'   );
      shaders.load( 'fs-text' , 'text' , 'fragment' );

      shaders.load( 'vs-title' , 'title' , 'vertex'   );
      shaders.load( 'fs-title' , 'title' , 'fragment' );


      shaders.load( 'vs-gem' , 'gem' , 'vertex'   );
      shaders.load( 'fs-gem' , 'gem' , 'fragment' );

      shaders.load( 'vs-ray' , 'ray' , 'vertex'   );
      shaders.load( 'fs-ray' , 'ray' , 'fragment' );


      var uniforms = {
        
        dT:       { type:"f"  , value : 0             },
        time:     { type:"f"  , value : 0             },
        progress: { type:"f"  , value : 0             },
        iModelMat:{ type:"m4" , value: new THREE.Matrix4() }
      }

      var linkInfo = [];

      linkInfo.push({
        title: 'Donate to ACLU',
        href: "http://aclu.org/Donate"
      });

      linkInfo.push({
        title: "Contact your House Representive",
        href: "http://www.house.gov/representatives/find/"
      });

      linkInfo.push({
        title: "Donate the Muslim Legal Fund of America",
        href: "https://www.mlfa.org/donate/"
      });

      linkInfo.push({
        title: "Share on Twitter",
        href: "https://www.mlfa.org/donate/"
      });



      function init(){

        var w = window.innerWidth;
        var h = window.innerHeight;

        camera = new THREE.PerspectiveCamera( 65 , w/h , .001 , 10 );
        camera.position.z = 1;

        controls = new ScrollControls( camera );
        
        clock = new THREE.Clock();
        
        scene = new THREE.Scene();


        var dpr = window.devicePixelRatio || 1;
        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( dpr );
        renderer.setSize( window.innerWidth, window.innerHeight );

        document.body.appendChild( renderer.domElement );

        /*

           Object Control stuff!!!!

        */ 

        objectControls = new ObjectControls( camera );


        var font = PTMono( '../../fonts/PTMono.png' );

        var vs = shaders.vertexShaders.text;
        var fs = shaders.fragmentShaders.text;


       /* title = new TextParticles( "I Love You" , font , vs , fs , {
         letterWidth: .05,
         lineLength: 29,
         uniforms:{
          time: time,
         }  
        });
        

        title.position.x = -title.totalWidth / 2;
       // title.position.z = -.2;
        title.position.y = .3;*/




        // Passage comes from seperate file
        textParticles = new TextParticles( iloveyou , font , vs , fs , {
         letterWidth: .02,
         lineLength: 80,
         uniforms:{
          time: time,
         }  
        });
        
        scene.add( textParticles );
       // scene.add( title );

        //textParticles.material.uniforms.time.value = 1.;

        textParticles.position.x = - textParticles.totalWidth / 2;

        controls.minPos     = -textParticles.totalHeight * 1.8;
        controls.maxPos     =  0;
        controls.multiplier =  .000003 * textParticles.totalHeight;
        controls.dampening  = .95;


        links = [];
        for( var i = 0; i < linkInfo.length; i++ ){

         links[i] = new Link(font , linkInfo[i].title ,linkInfo[i].href  );
         links[i].add( new THREE.Vector3( 0,-i*.1 - 20 , 0));




        }




        firstLight = new Light();

        firstLight.add();

        var l = new THREE.Vector3( 0 , .3,-.5 );
        firstLight.setPos( l);


        secondLight = new Light();

        secondLight.add();

        var l = new THREE.Vector3( 0 , -2 ,-.5 );
        secondLight.setPos( l);

        //secondLight.setBreakingShimmer( .01 );




        thirdLight = new Light();

        thirdLight.add();

        var l = new THREE.Vector3( 0 , -3.8 ,-.5 );
        thirdLight.setPos( l);

        thirdLight.setBreakingShimmer( .01 );


        fourthLight = new Light();

        fourthLight.add();

        var l = new THREE.Vector3( 0 , -5 ,-.5 );
        fourthLight.setPos( l);

        fourthLight.setBWVals( -4.8 , -5.2 );



        fifthLight = new Light(3.8, .6 , 30 );

        fifthLight.add();

        var l = new THREE.Vector3( 0 , -6.2 ,-.5 );
        fifthLight.setPos( l);

        fifthLight.setRayFill( -6 , -9.5 );



        sixthLight = new Light(1 , .3 , 30 );

        sixthLight.add();

        var l = new THREE.Vector3( 0 , -9.8 ,-.5 );
        sixthLight.setPos( l);

        sixthLight.setRayFill( -10 , -10.5 );


        seventhLights = [];

        for( var i = 0; i < 10; i++ ){
          

          seventhLights[i] = new Light(1 , .1 , 30 );

          seventhLights[i].add();


          var h= -10.5 - Math.random() * 2 ;
          var l = new THREE.Vector3( (Math.random() - .5) * 4 , h ,-.5 - Math.random() * 2 );
          seventhLights[i].setPos( l);

          seventhLights[i].setRayFill( h , h - .3 );

        }

        eighthLights = [];

        for( var i = 0; i < 10; i++ ){
          

          eighthLights[i] = new Light(1 , .1 , 30 );

          eighthLights[i].add();


          var h= -13 - Math.random() * 3;
          var l = new THREE.Vector3( (Math.random() - .5) * 4 , h ,-.5 - Math.random() * 4 );
          eighthLights[i].setPos( l);

          eighthLights[i].setBWVals( h , h + .3 );
          eighthLights[i].setRayFill( h , h - .3 );

        }




        window.addEventListener( 'resize', onWindowResize, false );

      }

      
      function animate(){

        requestAnimationFrame( animate );

        time.value += clock.getDelta();
        firstLight.update();
        secondLight.update();
        thirdLight.update();
        fourthLight.update();
        fifthLight.update();
        sixthLight.update();

        for( var i = 0; i < seventhLights.length; i++ ){
          seventhLights[i].update();
        }

        for( var i = 0; i < eighthLights.length; i++ ){
          eighthLights[i].update();
        }

        objectControls.update();
        controls.update();
        renderer.render( scene , camera );


      }


      function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

    </script>

  </body>
</html>
